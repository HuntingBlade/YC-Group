@#
layout("../common/base.html",{title:'亿创电力集团',nav:'index',header_css:""}){
#@
<div class="comm-warp-position">
    <div class="comm-wrapper-img">
        <div style="background: url(^{channelTopImg.sysValue!}) no-repeat center bottom;"></div>
    </div>
    <div class="comm-wrapper-content">
        <div class="comm-content-title">
            <div class="title">^{channelTitle.name}</div>
            <div>^{channelTitle.pageName}</div>
        </div>

        <div class="comm-content-title-nav">
            <ul id="nav_list">
                @#for(nav in navList){
                #@
                <li>
                    <a id="nav^{navLP.dataIndex}" value="^{nav.id}">^{nav.name}</a>
                </li>
                @#}#@
            </ul>
        </div>

        <div class="content-main">
            <div class="content-img-list">
                <ul id="qualification-content" class="banimg"></ul>
                <!-- 分页 -->
                <div id="test1" style="text-align: center"></div>
            </div>
            @#for(article in qualificationArticleList) { #@
            <div class="content-main1"
                 style="background: url(^{article.titleImg!}) no-repeat bottom center; background-size: 100% auto;">
                <div class="content-main1-child">
                    <h2>
                        <i></i>
                        ^{article.title}
                        <i></i>
                    </h2>
                    ^{article.content}
                    @# }#@
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        setWid();
        var pageNum = 1;
        var pageSize = 8;
        var total = 0;
        var channelId = 0;
        var navLen = $("#nav_list").children("li").length;
        if (navLen < 0) {
            return;
        }
        $("#nav0").addClass("active");
        channelId = $("#nav0").attr("value");
        total = setSonChannelContent(channelId, pageNum, pageSize);
        page(channelId, total, pageNum, pageSize);
        $("#nav_list a").on("click", function () {
            var id = $(this).attr("id");
            for (var i = 0; i < navLen; i++) {
                var cid = $("#nav" + i).attr("id");
                if (id != cid) {
                    $("#nav" + i).removeClass("active");
                }
                $("#" + id).addClass("active");
                continue;
            }
            var hurl = window.location.protocol + "//" + window.location.host + "/front/public/channelInfo";
            channelId = $(this).attr("value");
            var data = {
                "channelId": channelId,
                "pageNum": pageNum,
                "pageSize": pageSize
            };
            $.ajax({
                type: "POST",
                url: hurl,
                async: true,
                dataType: "json",
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    $("#qualification-content").empty();
                    total = res.total;
                    for (var i = 0; i < res.list.length; i++) {
                        $("#qualification-content").append("<li>" +
                            "<a>" +
                            "<div class='case-img'>" +
                            "<img src='" + res.list[i].titleImg + "'>" +
                            "</div>" +
                            "<div class='case-info'>" +
                            "<h1 id='h1" + i + "'></h1>" +
                            "</div>" +
                            "</a>" +
                            "</li>");
                        $("#h1" + i).text(res.list[i].title);
                    }
                    page(channelId, total, pageNum, pageSize);
                }
            });
        });
    });


    function page(channelId, total, pageNum, pageSize) {
        layui.use('laypage', function () {
            var laypage = layui.laypage;
            //执行一个laypage实例
            laypage.render({
                theme: "#0d2e3d",
                elem: 'test1', //注意，这里的 test1 是 ID，不用加 # 号
                count: total, //数据总数，从服务端得到
                curr: pageNum,
                limit: pageSize,
                jump: function (obj, first) {
                    //首次不执行
                    if (!first) {
                        $("#qualification-content").empty();
                        setSonChannelContent(channelId, obj.curr, obj.limit);
                    }
                }
            });
        });
    }

    /**
     * 获取指定栏目的内容
     * @param channelId
     * @param pageNum
     * @param pageSize
     */
    function setSonChannelContent(channelId, pageNum, pageSize) {
        var hurl = window.location.protocol + "//" + window.location.host + "/front/public/channelInfo";
        var _total = 0;
        var data = {
            "channelId": channelId,
            "pageNum": pageNum,
            "pageSize": pageSize
        };
        $.ajax({
            type: "POST",
            url: hurl,
            async: false,
            dataType: "json",
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (res) {
                var _length = res.list.length;
                _total = res.total;
                for (var i = 0; i < _length; i++) {
                    $("#qualification-content").append("<li>" +
                        "<a>" +
                        "<div class='case-img'>" +
                        "<img src='" + res.list[i].titleImg + "'>" +
                        "</div>" +
                        "<div class='case-info'>" +
                        "<h1 id='h1" + i + "'></h1>" +
                        "</div>" +
                        "</a>" +
                        "</li>");
                    $("#h1" + i).text(res.list[i].title);
                }
            }
        });
        return _total;
    }

    function setWid() {
        var wid = $(".banimg").width();
        var wid_li = wid / 4.1;
        var h_li = wid_li * 1.52;
        $(".banimg li").width(wid_li);
        $(".banimg li").height(h_li);
        var wid_img = wid_li * 0.96;
        var h_img = wid_img * 1.4;
        $(".banimg .case-img").height(h_img);
    }

</script>
@# } #@